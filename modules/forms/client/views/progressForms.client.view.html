<div  ng-controller="progressFormsController" class="pForms" data-ng-init="initPatient()">
    <!-- Information about selected patient -->
    <div class="row">
        <div class="col-xs-12">
            <h1 class="text-info">[{{activePatient.patientId}}] Visit Form</h1>
        </div>
        <div class="col-xs-12 col-sm-8">
            <h5>Client: LastName, {{activePatient.firstName}}</h5>
            <h5>Phone: (0000) 000-0000</h5>
        </div>
        <div class="col-xs-12 pull-right col-sm-4 col-md-3">
            <h5>Initial Weight: {{activePatient.startWeight}}</h5>
            <h5>Ideal Weight: 2 lbs</h5>
        </div>
    </div>
    <hr/>
    <accordion close-others="oneAtTime">
        <!--ADD NEW FORMS-->
        <accordion-group>
            <accordion-heading>
                <div class="row">
                    <div class="col-xs-12">
                        Add New Form<i class="pull-right glyphicon-plus"></i>
                    </div>
                </div>
            </accordion-heading>
            <accordion-body>

                <form data-ng-submit="createProgressForm()" class="form-horizontal">

                    <!-- Actual form-->
                    <div class="row">
                        <div class="col-sm-7">
                            <!-- Today's Weight -->
                            <div class="row form-inline">
                                <label class="col-sm-4 control-label">Today's Weight</label>
                                <div class="col-xs-6 col-sm-3 input-group">
                                    <input data-ng-model="weight.lb" data-ng-change="weight.kg = lbToKg(weight.lb)" class="form-control" id="focusedInput" type="text" placeholder="Enter weight"><em class="input-group-addon">lb</em>
                                </div>
                                <div class="col-xs-6 col-sm-3 col-sm-offset-1 input-group">
                                   <input data-ng-model="weight.kg" data-ng-change="weight.lb = lbToKg(weight.kg)" class="form-control" id="focusedInput" type="text" placeholder="Enter weight"><em class="input-group-addon">kg</em>
                                </div>
                            </div>
                            <!-- Last Weight -->
                            <div class="row form-inline">
                                <label class="col-sm-4 control-label">Last Weight</label>
                                <div class="col-sm-4">
                                    <span class="static-data">{{kgToLb(getLastWeight(-1))}} <em>lb</em></span>
                                </div>
                                <div class="col-sm-4">
                                    <span class="static-data">{{getLastWeight(-1) | number:2}} <em>kg</em></span>
                                </div>
                            </div>
                            <!-- Today Weight Loss -->
                            <div class="row form-inline">
                                <label class="col-sm-4 control-label">Today Weight Loss</label>
                                <div class="col-sm-4">
                                    <span class="static-data">{{kgToLb(getTodayWeightLoss(weight.kg, -1))}} <em>lb</em></span>
                                </div>
                                <div class="col-sm-4">
                                    <span class="static-data">{{getTodayWeightLoss(weight.kg, -1) | number:2}} <em>kg</em></span>
                                </div>
                            </div>
                            <!-- % Weight Loss / week -->
                            <div class="row form-inline">
                                <label class="col-sm-4 control-label">% Weight Loss / week</label>
                                <div class="col-sm-8">
                                    <!--To be computed using angularJs-->
                                    <span class="static-data">{{getAvgWeightLossPerWeek()}} <em>%</em></span>
                                </div>
                            </div>
                            <!-- Trimauxil Use && Weight Loss Appropriate-->
                            <div class="form-group form-inline">
                                <!-- Trimauxil Use -->
                                <label class="col-sm-4 control-label">Trimauxil Use</label><br/>
                                <div class="col-sm-8" >
                                    <input data-ng-model="trimauxilUse" type="radio" name="trimauxilUse" value="Overuse"> Overuse (ran out > 2 days)<br/>
                                    <input data-ng-model="trimauxilUse" type="radio" name="trimauxilUse" value="Just Right"> Just Right (+/- 2 doses)<br/>
                                    <input data-ng-model="trimauxilUse" type="radio" name="trimauxilUse" value="Underuse"> Underuse (>2 doses remaining)<br/>
                                </div>
                            </div>
                            <!-- Trimauxil Dose -->
                            <div class="row form-inline">
                                <label class="col-sm-4 control-label">Trimauxil Dose</label>
                                <div class="col-sm-8">
                                    <span class="static-data">{{getTrimauxilDose(weight.lb)}}</span>
                                </div>
                            </div>
                            <!-- Feeding adjustment needed -->
                            <div class="row form-inline">
                                <label class="col-sm-4 control-label">Feeding Adjustment needed</label>
                                <div class="col-sm-8">
                                    <label class="radio-inline"><input data-ng-model="feedingAjustment" type="radio" value="true"> yes</label>
                                    <label class="radio-inline"><input data-ng-model="feedingAjustment"type="radio" value="false"> no</label>
                                </div>
                            </div>
                            <!-- Food Changed -->
                            <div class="row form-group form-inline">
                                <label class="col-xs-12 col-sm-4 control-label">Food Changed</label>
                                <div class="col-xs-12 col-sm-8">
                                    <label class="radio-inline"><input data-ng-model="foodChanged" type="radio" name="foodChanged" value="true" data-ng-change="enterFood = true"> yes</label>
                                    <label class="radio-inline"><input data-ng-model="foodChanged" type="radio" name="foodChanged" value="false" data-ng-change="enterFood = false"> no</label>
                                </div>
                            </div>
                            <div class="row form-group form-inline" ng-hide="!enterFood">
                                <div class="col-sm-4"><small class="pull-right control-label">Enter food information</small></div>
                                <div class="col-xs-6 col-sm-3 input-group">
                                    <input data-ng-model="foodCalPerCup" class="form-control" id="focusedInput" type="text"><em class="input-group-addon">cal/cup</em>
                                </div>
                                <div class="col-xs-6 col-sm-3 col-sm-offset-1 input-group">
                                    <input data-ng-model="foodKCalPerKg" class="form-control" id="focusedInput" type="text"><em class="input-group-addon">kcal/kg</em>
                                </div>
                            </div>
                        </div>
                        <!-- Columns containing Comments and approval -->
                        <div class="col-sm-5">
                            <!-- Trimauxil Dose -->
                            <div class="form-group">
                                <label class="col-xs-12" for="comments">Comments</label>
                                <div class="col-xs-12">
                                    <textarea data-ng-model="comments" class="form-control" rows="10" id="comment" placeholder="Enter comments if applicable"></textarea>
                                </div>
                            </div>
                            <!-- Tech Initial -->
                            <div class="form-group">
                                <label class="col-xs-12 col-sm-3">Tech ID</label>
                                <div class="col-xs-12 col-sm-9">
                                    <input data-ng-model="techId" class="form-control" id="focusedInput" type="text" placeholder="Enter Tech ID">
                                </div>
                            </div>
                            <!-- Vet Initial -->
                            <div class="form-group">
                                <label class="col-xs-12 col-sm-3">Vet ID</label>
                                <div class="col-xs-12 col-sm-9">
                                    <input data-ng-model="vetId" class="form-control" id="focusedInput" type="text" placeholder="Enter Vet ID">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Row containing Cancel and Save button -->
                    <div class="row">
                        <div class="col-xs-6 col-xs-offset-6">
                            <button type="submit" class="btn btn-primary pull-right">Save</button>
                            <button ng-click="cancelEditing()" type="button" class="btn btn-default pull-right">Cancel</button>
                        </div>
                    </div>
                </form>
            </accordion-body>
        </accordion-group>
        <br/>
<!--==============================================================================================-->
        <!--PAST FORMS-->
        <accordion-group is-open="form.isOpen" ng-repeat="form in activePatient.progressForms | orderBy:'dateCreated':true">
            <accordion-heading>
                <div class="row">
                    <div class="cols-xs-9 col-sm-4">
                        <i data-ng-hide="!formsLocked" class="glyphicon glyphicon-lock"></i>
                        <i data-ng-hide="formsLocked" ng-class="{'glyphicon glyphicon-ok text-success' : !form.edit, 'glyphicon glyphicon-pencil text-danger': form.edit}"></i>
                        &nbsp; Last visit: <em>{{form.dateCreated | date:mediumDate}}</em>
                    </div>
                    <div class="cols-xs-0 hidden-xs col-sm-3 text-left">Weight: <em>{{form.weight}} kg</em></div>
                    <div class="cols-xs-0 hidden-xs col-sm-3 text-center">Weight loss/week: <em>{{getAvgWeightLossPerWeek()}} %</em></div>
                    <div class="cols-xs-3 hidden-xs col-sm-2">
                        <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': form.isOpen, 'glyphicon-chevron-right': !form.isOpen}"></i>
                    </div>
                </div>
            </accordion-heading>
            <acordion-body>

                <form name="editProgressForm" class="form-horizontal" data-ng-submit="updateProgressForm(form.index)">
                <!-- submit should be changed to 'editProgressForm()' for past forms -->
                    
                    <!-- Actual form-->
                    <div class="row">
                        <div class="col-sm-7">
                            <!-- Today's Weight -->
                            <div class="row form-inline">
                                <label class="col-sm-4 control-label">Weight</label>
                                <div class="col-xs-6 col-sm-3 input-group">
                                    <input data-ng-model="form.weightLb" data-ng-change="form.weightKg = lbToKg(form.weightLb)" ng-readonly="disableField" class="form-control" id="focusedInput" type="text" placeholder="{{disableField ? kgToLb(form.weight) : 'Enter weight'}}" ><em class="input-group-addon">lb</em>
                                </div>
                                <div class="col-xs-6 col-sm-3 col-sm-offset-1 input-group">
                                   <input data-ng-model="form.weightKg" data-ng-change="form.weightLb = kgToLb(form.weightKg)" ng-readonly="disableField" class="form-control" id="focusedInput" type="text" placeholder="{{disableField ? form.weight : 'Enter weight'}}"><em class="input-group-addon">kg</em>
                                </div>
                            </div>
                            <!-- Last Weight -->
                            <div class="row form-inline">
                                <label class="col-sm-4 control-label">Last Weight</label>
                                <div class="col-sm-4">
                                    <span class="static-data">{{kgToLb(getLastWeight(form.index))}} <em>lb</em></span>
                                </div>
                                <div class="col-sm-4">
                                    <span class="static-data">{{getLastWeight(form.index) | number:2}} <em>kg</em></span>
                                </div>
                            </div>
                            <!-- Today Weight Loss -->
                            <div class="row form-inline">
                                <label class="col-sm-4 control-label">Today Weight Loss</label>
                                <div class="col-sm-4">
                                    <span class="static-data">{{kgToLb(getTodayWeightLoss(weight.kg, form.index))}} <em>lb</em></span>
                                </div>
                                <div class="col-sm-4">
                                    <span class="static-data">{{getTodayWeightLoss(weight.kg, form.index) | number:2}} <em>kg</em></span>
                                </div>
                            </div>
                            <!-- Avg Weight Loss -->
                            <div class="row form-inline">
                                <label class="col-sm-4 control-label">% Weight Loss / week</label>
                                <div class="col-sm-8">
                                    <!--To be computed using angularJs-->
                                    <span class="static-data">{{getAvgWeightLossPerWeek()}} <em>%</em></span>
                                </div>
                            </div>
                            <!-- Trimauxil Use && Weight Loss Appropriate-->
                            <div class="form-group">
                                <!-- Trimauxil Use -->
                                <label class="col-sm-4 control-label">Trimauxil Use</label><br/>
                                <div class="col-sm-8" >
                                    <input ng-disabled="disableField" data-ng-model="form.trimauxilUse" type="radio" name="trimauxilUse" value="Overuse"> Overuse (ran out > 2 days)<br/>
                                    <input ng-disabled="disableField" data-ng-model="form.trimauxilUse" type="radio" name="trimauxilUse" value="Just Right"> Just Right (+/- 2 doses)<br/>
                                    <input ng-disabled="disableField" data-ng-model="form.trimauxilUse" type="radio" name="trimauxilUse" value="Underuse"> Underuse (>2 doses remaining)<br/>
                                </div>
                            </div>
                            <!-- Trimauxil Dose -->
                            <div class="row form-inline">
                                <label class="col-sm-4 control-label">Trimauxil Dose</label>
                                <div class="col-sm-8">
                                    <span class="static-data">{{form.trimDose}}</span>
                                </div>
                            </div>
                            <!-- Feeding adjustment needed -->
                            <div class="row form-inline">
                                <label class="col-sm-4 control-label">Feeding Adjustment needed</label>
                                <div class="col-sm-8">
                                    <label class="radio-inline"><input data-ng-model="feedingAjustment" type="radio" value="true"> yes</label>
                                    <label class="radio-inline"><input data-ng-model="feedingAjustment"type="radio" value="false"> no</label>
                                </div>
                            </div>
                            <!-- Food Changed -->
                            <div class="form-group">
                                <label class="col-xs-12 col-sm-4 control-label">Food Changed</label>
                                <div class="col-xs-6 col-sm-3">
                                    <label class="radio-inline"><input ng-disabled="disableField" data-ng-model="form.foodChanged" type="radio" name="foodChanged" value="true"> Yes</label>
                                    <label class="radio-inline"><input ng-disabled="disableField" data-ng-model="form.foodChanged" type="radio" name="foodChanged" value="false"> No</label>
                                </div>
                                <div class="col-xs-6 col-sm-5">
                                    <input class="form-control" ng-readonly="disableField" id="focusedInput" type="text" placeholder="signed: Jane Doe">
                                </div>
                                <div class="col-xs-12 col-sm-6 col-sm-offset-4" ng-show="form.foodChanged">
                                    Display food that was selected if food was changed
                                </div>
                            </div>
                        </div>
                        <!-- Columns containing Comments and approval -->
                        <div class="col-sm-5">
                            <!-- Trimauxil Dose -->
                            <div class="form-group">
                                <label class="col-xs-12" for="comments">Comments</label>
                                <div class="col-xs-12">
                                    <textarea data-ng-model="form.comments" ng-readonly="disableField" class="form-control" rows="10" id="comment" placeholder="{{disableField ? form.comments : 'Enter comments if applicable'}}"></textarea>
                                </div>
                            </div>
                            <!-- Tech Initial -->
                            <div class="form-group">
                                <label class="col-xs-12 col-sm-3">Tech ID</label>
                                <div class="col-xs-12 col-sm-9">
                                    <input data-ng-model="form.techId" ng-readonly="disableField" class="form-control" id="focusedInput" type="text" placeholder="{{disableField ? form.techId : 'Enter Tech ID'}}">
                                </div>
                            </div>
                            <!-- Vet Initial -->
                            <div class="form-group">
                                <label class="col-xs-12 col-sm-3">Vet ID</label>
                                <div class="col-xs-12 col-sm-9">
                                    <input data-ng-model="form.vetId" ng-readonly="disableField" class="form-control" id="focusedInput" type="text" placeholder="{{disableField ? form.vetId : 'Enter Vet ID'}}">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Row containing Cancel and Save button -->
                    <div class="row">
                        <div class="col-xs-6 col-xs-offset-6">
                            <button ng-show="disableField && !formsLocked" ng-click="editForm(form.index)" type="button" class="btn btn-default pull-right"><span class="glyphicon glyphicon-pencil"></span> Edit</button>
                            <fieldset ng-show="!disableField">
                                <button type="submit" class="btn btn-primary pull-right">Save</button>

                                <button ng-click="cancelEditing(form.index)" type="button" class="btn btn-default pull-right">Cancel</button>

                            </fieldset>
                        </div>
                    </div>

                </form>

            </acordion-body>
        </accordion-group>
    </accordion>

</div>
